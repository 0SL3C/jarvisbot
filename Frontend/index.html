
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WeatherCare - Your climate in good hands</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="overlay"></div>
  <div class="content text-center">
    <h1>Welcome to WeatherCare</h1>
    <p>Get accurate forecasts and suggestions tailored for your trips</p>
    <div class="search-bar">
      <input type="text" placeholder="Search for a city or address">
      <button><i class='bx bx-search'></i></button>
    </div>
  </div>

  <section class="featured-cities container py-4" id="forecastContainer">
    
    <div class="weather-details-card">
      <h3>Lisbon</h3>
      <small>3:08 PM</small>
      <div class="temp">11°C</div>
      <div class="realfeel">RealFeel® 8° | Shade: 6°</div>
      <div class="description">Mostly cloudy</div>
      <div class="more-info">
        <span><i class='fas fa-wind'></i>Wind: N 28 km/h</span>
        <span><i class='fas fa-tachometer-alt'></i>Gusts: 28 km/h</span>
        <span><i class='fas fa-smog'></i>Air Quality: Excellent</span>
        <span><i class='fas fa-thermometer-half'></i>Humidity: 68%</span>
      </div>
    </div>
    <div class="weather-details-card">
      <h4>London</h4>
      <small>3:08 PM</small>
      <div class="temp">17°C</div>
      <div class="realfeel">RealFeel® 8° | Shade: 6°</div>
      <div class="description">Mostly cloudy</div>
      <div class="more-info">
        <span><i class='fas fa-wind'></i>Wind: N 28 km/h</span>
        <span><i class='fas fa-tachometer-alt'></i>Gusts: 28 km/h</span>
        <span><i class='fas fa-smog'></i>Air Quality: Excellent</span>
        <span><i class='fas fa-thermometer-half'></i>Humidity: 68%</span>
      </div>
    </div>
  </section>

  <section class="container py-4">
    <h2 class="text-center mb-4">Extended forecast</h2>
    <p class="text-center text-muted">Check temperature details and weather conditions for the next few days in different cities.</p>
  </section>

  <div id="chat-widget" class="shadow hidden">
    <div id="chat-header">
      <span>Climate Assistant</span>
      <button class="btn btn-sm btn-light" id="closeChatBtn">×</button>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input">
      <input type="text" id="chatInput" placeholder="Ask about the weather...">
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <div id="chatToggle">
    <i class='bx bx-message-rounded-dots'></i>
  </div>

  <script>
  async function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message) return;

    const chatBox = document.getElementById('chat-messages');

    const userDiv = document.createElement('div');
    userDiv.className = 'message user';
    userDiv.innerText = message;
    chatBox.appendChild(userDiv);

    const typing = document.createElement('div');
    typing.className = 'message bot typing-indicator';
    typing.innerHTML = `<span></span><span></span><span></span>`;
    chatBox.appendChild(typing);
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
      const response = await fetch('http://localhost:8080/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: message
      });
      const reply = await response.text();
      typing.remove();

      const botDiv = document.createElement('div');
      botDiv.className = 'message bot';
      botDiv.innerText = reply;
      chatBox.appendChild(botDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (error) {
      typing.remove();
      const errorDiv = document.createElement('div');
      errorDiv.className = 'message bot';
      errorDiv.innerText = '❌ Error connecting to server.';
      chatBox.appendChild(errorDiv);
    }

    input.value = '';
  }

  async function fetchForecast(cityName) {
    try {
      const response = await fetch('http://localhost:8080/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: `weather:${cityName.toLowerCase()}:today`
      });

      const data = await response.text();
      renderWeatherCard(cityName, data);
    } catch (error) {
      console.error("Error fetching forecast", error);
      renderWeatherCard(cityName, "❌ Couldn't load data");
    }
  }

  function renderWeatherCard(city, rawHtml) {
    const container = document.getElementById('forecastContainer');

    const card = document.createElement('div');
    card.className = 'weather-details-card';

    card.innerHTML = `
      <h3>${city}</h3>
      <small>${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</small>
      <div class="description">${rawHtml}</div>
    `;
    container.appendChild(card);
  }

  document.addEventListener("DOMContentLoaded", () => {
    const widget = document.getElementById("chat-widget");
    const toggle = document.getElementById("chatToggle");
    const closeBtn = document.getElementById("closeChatBtn");
    const sendBtn = document.getElementById("sendBtn");
    const input = document.getElementById("chatInput");

    toggle.addEventListener("click", () => {
      widget.classList.toggle("hidden");
    });

    closeBtn.addEventListener("click", () => {
      widget.classList.add("hidden");
    });

    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keypress", (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Cidades para buscar a previsão
    const cities = ["Lisbon", "Paris", "Tokyo"];
    cities.forEach(city => fetchForecast(city));

    // Cores para temperaturas
    const temps = document.querySelectorAll('.temp');
    temps.forEach(el => {
      const value = parseFloat(el.textContent);
      if (value >= 25) el.style.color = '#ff6b6b';
      else if (value < 10) el.style.color = '#3399ff';
    });
  });
</script>
</body>
</html>
